<!DOCTYPE html><html lang="ru"><head>
<meta charset="utf-8"><title>Оформление заказа</title>
<link rel="stylesheet" href="styles.css">
</head><body>
  <div class="container">
    <h1 id="product-name">Товар</h1>

    <form id="order-form" style="max-width:500px">
      <label>Имя<input required id="name"></label>
      <label>E-mail<input type="email" required id="email"></label>
      <label>Телефон<input required id="phone"></label>
      <label>Адрес доставки<textarea required id="addr"></textarea></label>
      <label>Город<input required id="city"></label>
      <label>Индекс<input required id="zip"></label>
      <label>Количество<input type="number" min="1" value="1" id="qty"></label>
      <button class="btn" type="submit">Подтвердить заказ</button>
    </form>
  </div>

<script src="script.js"></script>
<script>
(async ()=>{
 const id = new URLSearchParams(location.search).get('id');
 if(!id){ showNotification('Не указан товар','error'); return; }

 const p = await fetch(`http://localhost:8001/api/v1/products/${id}`).then(r=>r.json());
 document.getElementById('product-name').textContent = p.name;

 document.getElementById('order-form').addEventListener('submit', async e=>{
   e.preventDefault();
   const body = {
     customer_name: name.value,
     customer_email: email.value,
     customer_phone: phone.value,
     address_line: addr.value,
     city: city.value,
     postal_code: zip.value,
     items:[{product_id:id, quantity:+qty.value}]
   };
   const res = await fetch('http://localhost:8002/api/v1/orders',{
     method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)
   });
   if(res.ok){ showNotification('Заказ принят!'); location.href='index.html'; }
   else{ const err = await res.json(); showNotification(err.detail||'Ошибка','error'); }
 });
})();
</script>
</body></html>
